--configuracion del wppApi

CREATE TABLE config_chats (
    id INT AUTO_INCREMENT PRIMARY KEY,
    telefono varchar(255),
    id_telefono varchar(255),
    token_permanente varchar(255),
    empresas bigint unsigned  NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT fk_empresas_config_chats FOREIGN KEY (empresas) REFERENCES empresas(id)
);

--Manejo de los chats entrantes
CREATE TABLE contactos_chats (
    id INT AUTO_INCREMENT PRIMARY KEY,
    telefono varchar(255),
    nombre varchar(255),
    id_telefono varchar(255),
    empresas bigint unsigned  NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT fk_empresas_contactos_chat FOREIGN KEY (empresas) REFERENCES empresas(id)
);
--mensajes recibidos y enviados 
CREATE TABLE messages_chats (
    id INT AUTO_INCREMENT PRIMARY KEY,
    telefono varchar(255),
    message text,
    timestamp_message varchar(255),
    id_telefono varchar(255),
    send int(1),
    empresas bigint unsigned  NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT fk_empresas_messages_chats FOREIGN KEY (empresas) REFERENCES empresas(id)
);

alter table contactos_chats add column id_users bigint unsigned
alter table contactos_chats ADD CONSTRAINT fk_contactos_chats_id_usres FOREIGN KEY (id_users) REFERENCES users(id);

alter table config_chats add column id_users bigint unsigned
alter table config_chats ADD CONSTRAINT fk_contactos_config_chats FOREIGN KEY (id_users) REFERENCES users(id);



CREATE TABLE costo_usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    valor float,
    id_user bigint unsigned  NOT NULL,
    empresas bigint unsigned  NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT fk_empresas_cosot_usuarios FOREIGN KEY (empresas) REFERENCES empresas(id),
    CONSTRAINT fk_usuarios_costos FOREIGN KEY (id_user) REFERENCES users(id)
);

se agrega tabla de montos vigentes 
create table monto_usuarios (	
    id INT AUTO_INCREMENT PRIMARY KEY,
	valor float not null,
    id_user bigint unsigned  NOT NULL,
    empresas bigint unsigned  NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
   	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
   	CONSTRAINT fk_empresas_cosot_usuarios_monto FOREIGN KEY (empresas) REFERENCES empresas(id),
   	CONSTRAINT fk_usuarios_costos_monto FOREIGN KEY (id_user) REFERENCES users(id)
)

campos de auto 2 
ALTER TABLE vehiculos
ADD COLUMN combustible VARCHAR(255) NULL COMMENT 'Tipo de combustible del vehículo',
ADD COLUMN cilindraje DECIMAL(10,2) NULL COMMENT 'Cilindraje del motor en cc',
ADD COLUMN facecolda DECIMAL(10,2) NULL COMMENT 'Valor de referencia FACECOLDA',
ADD COLUMN accesorios TEXT NULL COMMENT 'Lista de accesorios del vehículo',
ADD COLUMN llave varchar(255) NULL COMMENT 'indica en que parte tiene la llave ';


--creando campo para almacenar las vistas 
create table views (	
    id INT AUTO_INCREMENT PRIMARY KEY,
	wiew TEXT not null,
    empresas bigint unsigned  NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
   	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
   	CONSTRAINT fk_empresas_views FOREIGN KEY (empresas) REFERENCES empresas(id)
)


generador de reportes v01 
CREATE TABLE reporte_fuente_datos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    consulta varchar(255),
    empresas bigint unsigned  NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT fk_empresas_reporte_fuente_datos FOREIGN KEY (empresas) REFERENCES empresas(id)
);
alter table reporte_fuente_datos add column nombre VARCHAR(255) DEFAULT 'sin nombre'

CREATE TABLE reportes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre varchar(255),
    secciones INT not null,
    empresas bigint unsigned  NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT fk_empresas_reporte_id FOREIGN KEY (empresas) REFERENCES empresas(id)
    CONSTRAINT fk_seccion_reportes_seccion FOREIGN KEY (secciones) REFERENCES secciones(id)
);


CREATE TABLE reportes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre varchar(255),
    empresas bigint unsigned  NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT fk_empresas_reporte_fuente_datos FOREIGN KEY (empresas) REFERENCES empresas(id)
);
CREATE TABLE reportes_for_fuentes(
    id INT AUTO_INCREMENT PRIMARY KEY,
    reportes int not null UNIQUE,
    fuente INT not null,
    empresas bigint unsigned  NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT fk_reportes_for_fuente_empresa FOREIGN KEY (empresas) REFERENCES empresas(id),
    CONSTRAINT fk_reportes_for_fuente_fuente FOREIGN KEY (fuente) REFERENCES reporte_fuente_datos(id),
    CONSTRAINT fk_reportes_for_fuente_reporte FOREIGN KEY (reportes) REFERENCES reportes(id)
);

CREATE TABLE reportes_config (
    id INT AUTO_INCREMENT PRIMARY KEY,
    campo varchar(255),
    seleccion INT not null,
    titulo varchar(255),
    color varchar(255),
    filtro varchar(255),
    posicion int,
    total int,
    reportes int not null,
    empresas bigint unsigned  NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT fk_reporte_empresas_config FOREIGN KEY (empresas) REFERENCES empresas(id),
    CONSTRAINT fk_reporte_config_id FOREIGN KEY (reportes) REFERENCES reportes(id)
);
